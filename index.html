<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockchain Maiden Mint</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/merkletreejs@latest/merkletree.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/keccak256@latest/keccak256.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre Baskerville:200,300,400,500">


    
    <img src="background.jpeg" class="bg">

    <div class="topWrap">
        <h1 class="title"><u>THE BLOCKCHAIN MAIDEN</u></h1>
        <h2 class="mintedText" id="mintedText">8887/8887 Minted</h2>
    </div>

    <div class="mintButton" onclick="Mint()">MINT</div>

    <img class="maidenImage1" src="./1.png">
    <img class="maidenImage2" src="./2.png">
    <img class="maidenImage3" src="./3.png">
    <img class="maidenImage4" src="./4.png">
    <img class="maidenImage5" src="./5.png">
    <img class="maidenImage6" src="./6v2.png">
    <img class="maidenImage7" src="./7.png">
    <img class="maidenImage8" src="./8.png">
    <img class="maidenImage9" src="./9.png">
    <img class="maidenImage10" src="./10.png">
    <img class="maidenImage11" src="./11.png">

    <style>
        .bg{
            height: 100.5%;
            width: 100%;

            margin-top: -12px;
            margin-left: -8px;

            position: absolute;
        }

        .topWrap{
            position: absolute;

            top: 2.5%;
            left:25%;

            height: 10%;
            width: 50%;

            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .title{
            position: relative;

            color: deeppink;
            font-family: Libre Baskerville;
            font-size: 2.25em;
            font-weight: 400;
            text-align: center;

            margin-bottom: 10px;
        }

        .mintedText{
            position: relative;
            
            color: deeppink;
            font-family: Libre Baskerville;
            font-size: 1.5em;
            font-weight: 300;
            text-align: center;

            margin-top: 10px;
        }

        .mintButton{
            position: absolute;

            top: 50%;
            left: 50%;
            margin-top: -25px;
            margin-left: -75px;

            width: 150px;
            height: 50px;

            background-color: rgba(0, 0, 0, 0);

            border: 1px solid deeppink;

            color: deeppink;
            font-family: Libre Baskerville;
            font-size: 1.5em;
            font-weight: 300;
            text-align: center;

            display: flex;
            justify-content: center;
            align-items: center;

            cursor: pointer;
        }

        .maidenImage1{
            position: absolute;

            top: 25%;
            left:50%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage2{
            position: absolute;

            top: 80%;
            left:35%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }
        
        .maidenImage3{
            position: absolute;

            top: 80%;
            left:65%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage4{
            position: absolute;

            top: 75%;
            left:20%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage5{
            position: absolute;

            top: 75%;
            left:80%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage6{
            position: absolute;

            top: 60%;
            left:5%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage7{
            position: absolute;

            top: 60%;
            left:95%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage8{
            position: absolute;

            top: 45%;
            left:27.5%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage9{
            position: absolute;

            top: 45%;
            left:72.5%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage10{
            position: absolute;

            top: 35%;
            left:10%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        .maidenImage11{
            position: absolute;

            top: 35%;
            left:90%;
            margin-left: -66px;
            margin-top: -50px;

            width: 132px;
            height: 192px;
        }

        @media screen and (max-width: 1200px){
            .maidenImage4{
                visibility: hidden;
            }

            .maidenImage5{
                visibility: hidden;
            }

            .maidenImage6{
                visibility: hidden;
            }

            .maidenImage7{
                visibility: hidden;
            }

            .maidenImage10{
                visibility: hidden;
            }

            .maidenImage11{
                visibility: hidden;
            }
        }
    </style>
</head>

<body>
    <script type="text/javascript">
    var account;

    const address = "";
    const ABI = [];
    var contract = null;

    var totalMinted;
    var totalSupply = 8887;

    var isPub = false;
    var pubPrice;
    var isWL = false;
    var wlPrice;
    var isVIP = false;
    var vipPrice;

    var proof;

    const WLs = {
        0 : [
            ""
        ],
        1 : [
            ""
        ]
    };

    const ConnectWallet = async () =>{
            if(window.ethereum){
            //await window.ethereum.send('eth_requestAccounts');
			await ethereum.request({method: "eth_requestAccounts"});
            window.web3 = new Web3(window.ethereum);

            var accounts = await web3.eth.getAccounts();
            account = accounts[0];

            contract = new web3.eth.Contract(ABI, address);

            document.getElementById("connect").style.visibility = 'hidden';
            document.getElementById("mainSection").style.visibility = 'visible';

            let x = await loadData();
            changeMintedText();
            }
        }

        const loadData = async () =>{
            isPub = await contract.methods.isPublicSale().call({from: account});   
            pubPrice = await contract.methods.mintPrices(0).call({from: account});
            isWL = await contract.methods.isWhiteListSale().call({from: account});
            wlPrice = await contract.methods.mintPrices(1).call({from: account});
            isVIP = await contract.methods.isVIPSale().call({from: account});
            vipPrice = await contract.methods.mintPrices(2).call({from: account});

            totalMinted = await contract.methods.totalSupply().call({from: account});
        }

        const Mint = async () =>{
            if(isPub){
                await contract.methods.PublicMint(1).send({from: account, value: pubPrice}).then((res) =>{
                    totalMinted++;
                    changeMintedText();
                });
            }
            else if(isWL){
                findMerkleProof(0);

                await contract.methods.WhiteListMint(1, proof).send({from: account, value: wlPrice}).then((res) =>{
                    totalMinted++;
                    changeMintedText();
                });
            }
            else{
                findMerkleProof(1);

                await contract.methods.VIPMint(1, proof).send({from: account, value: vipPrice}).then((res) =>{
                    totalMinted++;
                    changeMintedText();
                })
            }
        }

        const findMerkleProof = (num) =>{
            var WL = WLs[num];
            

            const leaves = WL.map(x => keccak256(x));
		    const tree = new MerkleTree(leaves, keccak256, {sortPairs: true});
		    const buf2hex = x => '0x' + x.toString('hex');

		    console.log(buf2hex(tree.getRoot()));
		
		    const leaf = keccak256(account);
		    proof = tree.getProof(leaf).map(x => buf2hex(x.data));
        }

        const changeMintedText = () =>{
            document.getElementById("mintedText").textContent = `${totalMinted}/${totalSupply} Minted`;
        }
    </script>
</body>
</html>